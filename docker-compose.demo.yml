# OpenClutch Docker Compose - Demo Instance
# Isolated demo environment for screenshots and testing
# Fully separate from production instance on ports 3210/3211
#
# ⚠️ SAFETY NOTICE ⚠️
# This compose file is completely isolated from production.
# It uses ports 3230/3231 exclusively and its own named volume.
#
# Quick Start:
#   1. Start the demo instance:
#      docker compose -f docker-compose.demo.yml up -d
#
#   2. Deploy the Convex schema:
#      pnpm demo:deploy
#
#   3. Access the dashboard at http://localhost:3231
#
#   4. Stop and clean up:
#      pnpm demo:reset
#
# To generate a new admin key:
#   docker run --rm ghcr.io/get-convex/convex-backend:latest generate-key

name: openclutch-demo

services:
  # -----------------------------------------------------------------------------
  # Convex Backend (Demo Instance)
  # -----------------------------------------------------------------------------
  convex:
    image: ghcr.io/get-convex/convex-backend:latest
    container_name: openclutch-convex-demo
    restart: unless-stopped
    ports:
      - "3230:3210"  # Convex API port (demo) - maps external 3230 to internal 3210
      - "3231:3211"  # Convex dashboard port (demo) - maps external 3231 to internal 3211
    volumes:
      - convex-demo-data:/convex/data
    environment:
      # Storage configuration
      - CONVEX_STORAGE_TYPE=${CONVEX_STORAGE_TYPE:-sqlite}
      - CONVEX_SQLITE_PATH=${CONVEX_SQLITE_PATH:-/convex/data/convex.db}
      # Logging
      - RUST_LOG=${RUST_LOG:-info}
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3210/version"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    networks:
      - openclutch-demo-network

# -----------------------------------------------------------------------------
# Volumes
# -----------------------------------------------------------------------------
volumes:
  convex-demo-data:
    driver: local

# -----------------------------------------------------------------------------
# Networks
# -----------------------------------------------------------------------------
networks:
  openclutch-demo-network:
    driver: bridge
